<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>iPhone-style Mobile UI · Concept-alike</title>
  <!-- Google Maps API: callback 제거 (직접 호출) -->
  <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAxlcBbyxBP7TttzXGzoSIdbLFQ_5u6qtk"></script>
  <style>
    :root{
      --page-bg:url('images/bg_image.png');
      --device-scale: 0.8;
      --brand:#0a84ff;
      --glass: rgba(255,255,255,.65);
      --ink:#0b1220;
      --ink-mute:#6b7280;
      --ring: rgba(255,255,255,.08);
      --badge:#ff3b30;
      --tile:#0e1422;
      --bg-deep:#0a0f1a;
    }

    html,body{ height:100%; margin:0; font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial; background:#0b0f17; color:#e5e7eb; }

    /* ===== Stage (웹 배경 + 휴대폰) ===== */
    .stage {
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: clamp(12px, 3vw, 28px);
      overflow: hidden;
      position: relative;
      isolation: isolate; /* ::before가 부모 안에 머물도록 경계 설정 */
    }

    .stage::before {
      content: "";
      position: absolute;
      inset: -20px; /* 블러 효과가 퍼져나갈 여유 공간 확보 */
      background: var(--page-bg) center top / 120% no-repeat;
      filter: blur(8px); /* 블러 강도 조절 가능 */
      z-index: -1; /* 이제 .stage 안에서만 뒤로 감 */
    }

    .device-wrap{ 
      transform: scale(var(--device-scale)); 
      filter: drop-shadow(0 26px 38px rgba(0,0,0,.45)); 
      position:relative; 
      z-index: 1; /* 배경보다 확실히 위에 있도록 명시 */
      margin-top: 5vh;
    }

    /* ===== iPhone frame ===== */
    .iphone{ position:relative; width:390px; height:844px; border-radius:56px; padding:18px; background:linear-gradient(180deg,#0f1115,#151821); border:10px solid #0e1117; }
    .iphone:before{ content:""; position:absolute; inset:-10px; border-radius:64px; background:linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,0) 40%); -webkit-mask:linear-gradient(#000,#000) content-box,linear-gradient(#000,#000); -webkit-mask-composite:xor; mask-composite:exclude; padding:10px; pointer-events:none; opacity:.85; }
    .island{ position:absolute; top:12px; left:50%; transform:translateX(-50%); width:120px; height:36px; background:#000; border-radius:20px; z-index:5; box-shadow:0 1px 0 rgba(255,255,255,.08) inset; }
    .screen{ position:relative; height:100%; border-radius:38px; overflow:hidden; background:radial-gradient(120% 120% at 50% -20%, #2a3a7a, #0b0f17 60%); box-shadow: inset 0 0 0 1px rgba(255,255,255,.06); }

    /* ===== Status bar ===== */
    .statusbar{ position:absolute; top:8px; left:0; right:0; display:flex; justify-content:space-between; padding:8px 16px; color:#fff; font-weight:600; font-size:12px; z-index:4; text-shadow:0 1px 1px rgba(0,0,0,.6); }

    /* ===== Lock screen ===== */
    .lock{ position:absolute; inset:0; color:#fff; background:url('public\images\lockscreen-bg.jpg') center/cover no-repeat; display:flex; flex-direction:column; align-items:center; }
    .lock .clock{ margin-top:120px; font-size:92px; font-weight:300; letter-spacing:1px; line-height:.9; text-shadow:0 6px 24px rgba(0,0,0,.45); }
    .lock .date{ margin-top:8px; font-size:14px; opacity:.95; text-shadow:0 2px 8px rgba(0,0,0,.45); }

    /* 알림: 고정 높이 + 스크롤 + 페이드 마스크 */
    .lock .notif-wrap{ position:absolute; left:0; right:0; top:280px; bottom:80px; padding:0 16px; }
    .lock .notif-stack{ height:100%; overflow:auto; padding:2px 2px 10px; mask-image: linear-gradient(transparent, #000 8%, #000 92%, transparent); }
    .notif{ background:rgba(255,255,255,.9); color:#111; border-radius:16px; padding:12px 14px; display:grid; gap:2px; box-shadow:0 6px 18px rgba(0,0,0,.25); margin:10px 6px; }
    .notif .t{ font-weight:700; font-size:13px; }
    .notif .d{ font-size:12px; color:#374151; }

    .lock .hint{ position:absolute; bottom:18px; left:0; right:0; text-align:center; font-size:12px; opacity:.9; }

    /* ===== Home ===== */
    .home{ position:absolute; inset:0; display:flex; flex-direction:column; padding:64px 18px 24px; color:#fff; background:url('https://images.unsplash.com/photo-1520975922284-7b5168a6df4a?q=80&w=1600&auto=format&fit=crop') center/cover no-repeat; }
    .home[hidden]{ display:none !important; } /* hidden 속성 강제 적용 */
    .search-pill{ align-self:center; margin-top:auto; margin-bottom:98px; padding:8px 14px; border-radius:999px; background:rgba(255,255,255,.18); backdrop-filter:blur(8px); font-size:12px; color:#e5e7eb; }
    .home .grid{ display:grid; grid-template-columns:repeat(4,1fr); gap:16px; margin-top:14px; }
    .app-tile{ display:flex; flex-direction:column; align-items:center; gap:6px; background:none; border:none; cursor:pointer; color:#fff; }
    .icon{ position:relative; width:64px; height:64px; border-radius:18px; display:grid; place-items:center; font-size:26px; box-shadow: inset 0 -10px 30px rgba(0,0,0,.28), 0 6px 12px rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.08); }
    .icon span{ display:none; }
    .label{ font-size:11px; text-shadow:0 2px 8px rgba(0,0,0,.6); }
    .badge{ position:absolute; top:-4px; right:-4px; background:var(--badge); color:#fff; font-weight:800; height:20px; min-width:20px; padding:0 6px; display:grid; place-items:center; border-radius:999px; font-size:11px; box-shadow:0 2px 6px rgba(0,0,0,.35); }

    .i-cal{ background:linear-gradient(160deg,#ffffff,#f3f4f6); color:#111; }
    .i-photos{ background:linear-gradient(160deg,#60a5fa,#22d3ee); }
    .i-notes{ background:linear-gradient(160deg,#fff3a3,#ffd54f); color:#111; }
    .i-web{ background:linear-gradient(160deg,#ff6b6b,#f43f5e); }
    .i-maps{ background:linear-gradient(160deg,#34d399,#10b981); }
    .i-tv{ background:linear-gradient(160deg,#6366f1,#4338ca); }
    .i-ft{ background:linear-gradient(160deg,#22c55e,#16a34a); }
    .i-settings{ background:linear-gradient(160deg,#9ca3af,#6b7280); }
    .i-bom{ background:linear-gradient(160deg,#ff4dc8,#ff2e93); }

    .dock{ position:absolute; left:18px; right:18px; bottom:18px; padding:14px; border-radius:28px; background:rgba(255,255,255,.16); backdrop-filter:blur(10px); display:grid; grid-template-columns:repeat(2,1fr); gap:14px; }

    /* ===== App screens (modals) ===== */
    .app-screen{ position:absolute; inset:0; background:rgba(0,0,0,.35); display:none; align-items:center; justify-content:center; padding:18px; }
    .app{ width:min(360px,92%); max-height:86%; background:#0a0f1a; border-radius:28px; overflow:hidden; border:1px solid rgba(255,255,255,.08); display:flex; flex-direction:column; box-shadow:0 10px 40px rgba(0,0,0,.5); }
    .app .bar{ flex-shrink: 0; display:flex; align-items:center; gap:10px; padding:12px 14px; background:#0e1422; border-bottom:1px solid rgba(255,255,255,.06); }
    .app .body{ flex-grow: 1; overflow:auto; padding:14px; }
    .app .title{ font-weight:700; font-size:14px; }
    .spacer{ flex:1; }
    .x{ background:none; border:none; color:#9ca3af; font-weight:900; cursor:pointer; font-size:20px; }
    
    /* 지도 앱을 위한 스타일 수정 */
    #app-map .body {
      padding: 0; /* 지도가 꽉 차도록 패딩 제거 */
    }
    #map-canvas {
      width: 100%;
      height: 100%;
    }

    .chat{ display:grid; gap:8px; }
    .bubble{ max-width:80%; padding:10px 12px; border-radius:18px; }
    .bubble.me{ justify-self:end; background:#0b84ff; color:#fff; border-bottom-right-radius:6px; }
    .bubble.other{ justify-self:start; background:#1f2937; color:#e5e7eb; border-bottom-left-radius:6px; }
    .attach{ border-radius:12px; background:#0f172a; padding:10px; border:1px dashed #374151; font-size:12px; color:#94a3b8; }

    .cal{ display:grid; gap:10px; }
    .cal .month{ display:flex; justify-content:space-between; align-items:center; font-weight:700; }
    .cal .grid{ display:grid; grid-template-columns:repeat(7,1fr); gap:6px; }
    .day{ background:#0d1424; border:1px solid rgba(255,255,255,.06); border-radius:10px; padding:8px; min-height:42px; display:flex; align-items:flex-start; justify-content:flex-end; font-size:12px; color:#cbd5e1; position:relative; }
    .day.mark{ outline:2px solid #f59e0b; outline-offset:-2px; }
    .day.range{ background:linear-gradient(0deg, rgba(245,158,11,.35), rgba(245,158,11,.18)); }
    .pop-label{ position:absolute; bottom:6px; left:6px; right:6px; background:#f59e0b; color:#111; border-radius:6px; padding:2px 6px; font-weight:800; font-size:10px; text-align:center; }

    .gallery-grid{ display:grid; grid-template-columns:repeat(3,1fr); gap:6px; }
    .gallery-grid img{ width:100%; aspect-ratio:1/1; object-fit:cover; border-radius:10px; cursor:pointer; }
    .lightbox{ position:fixed; inset:0; background:rgba(0,0,0,.85); display:none; align-items:center; justify-content:center; z-index:50; }
    .lightbox img{ max-width:88vw; max-height:88vh; border-radius:12px; }

    .noise{ width:100%; aspect-ratio:16/9; border-radius:14px; background: repeating-linear-gradient(0deg,#111 0,#111 2px,#1a1a1a 2px,#1a1a1a 4px); display:grid; place-items:center; color:#cbd5e1; font-weight:800; letter-spacing:.1em; }
    
    .video {
      width: 100%;
      aspect-ratio: 16/9;
      border-radius: 14px;
      border: none; /* iframe 테두리 제거 */
    }

    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0; }

    /* ===== Unlock animation ===== */
    @keyframes unlockUp { from { transform: translateY(0); opacity:1; } to { transform: translateY(-40px); opacity:0; } }
    @keyframes homeIn { from { opacity:0; transform: scale(.98); filter: blur(2px); } to { opacity:1; transform: scale(1); filter: blur(0); } }
    .lock.unlocking{ animation: unlockUp .35s ease both; }
    .home.show{ animation: homeIn .35s ease both; }
     /* ===== Share Button & Modal ===== */
    .share-btn {
      position: absolute;
      bottom: 30px;
      left: 30px;
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, .2);
      border: 1px solid rgba(255,255,255,.1);
      border-radius: 50%;
      font-size: 20px;
      color: #fff;
      cursor: pointer;
      display: grid;
      place-items: center;
      z-index: 10;
    }

    .share-modal-overlay {
      position: fixed; /* 전체 화면을 덮기 위해 fixed 사용 */
      inset: 0;
      background: rgba(0, 0, 0, .4);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px); /* Safari 브라우저 호환성 */
      z-index: 100;
      display: none; /* 평소엔 숨겨둠 */
      align-items: center;
      justify-content: center;
    }

    .share-box {
      background: #1f2937;
      padding: 28px;
      border-radius: 20px;
      text-align: center;
      position: relative;
      border: 1px solid rgba(255,255,255,.1);
      box-shadow: 0 10px 30px rgba(0,0,0,.3);
    }

    .share-box p {
      margin: 0 0 16px;
      font-weight: 700;
      font-size: 14px;
      color: #e5e7eb;
    }

    .share-link svg {
      width: 50px;
      height: 50px;
      fill: #fff; /* SVG 아이콘 색상 */
      transition: transform .2s ease;
    }
    .share-link:hover svg {
        transform: scale(1.1);
    }

    .close-share {
      position: absolute;
      top: 8px;
      right: 12px;
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="stage">
    <button class="share-btn" id="shareBtn">🔗</button>

    <div class="device-wrap">
      <div class="iphone" role="region" aria-label="iPhone mockup">
        <div class="island" aria-hidden="true"></div>
        <div class="screen">

          <!-- Status bar -->
          <div class="statusbar">
            <div id="sb-time">9:41</div>
            <div>LTE • 🔋 100%</div>
          </div>

          <!-- ===== LOCK ===== -->
          <section class="lock" id="lock">
            <div class="clock" id="lock-clock">9:41</div>
            <div class="date" id="lock-date">2025년 04월 01일 (화)</div>

            <!-- 알림: 스크롤 영역 -->
            <div class="notif-wrap">
              <div class="notif-stack" id="notifStack" aria-label="알림 목록 (스크롤 가능)"></div>
            </div>

            <div class="hint">알림 외 영역 탭 또는 위로 스와이프 → 홈 화면</div>
          </section>

          <!-- ===== HOME ===== -->
          <section class="home" id="home" hidden>
            <div class="home-top"></div>
            <div class="grid">
              <button class="app-tile" data-app="cal"><div class="icon i-cal">📅</div><div class="label">Calendar</div></button>
              <button class="app-tile" data-app="gallery"><div class="icon i-photos">🖼️</div><div class="label">Photos</div></button>
              <button class="app-tile" data-app="note"><div class="icon i-notes">📝<span class="badge">1</span></div><div class="label">Notes</div></button>
              <button class="app-tile" data-app="web"><div class="icon i-web">📰</div><div class="label">Web</div></button>

              <button class="app-tile" data-app="map"><div class="icon i-maps">🗺️</div><div class="label">Maps</div></button>
              <button class="app-tile" data-app="ott"><div class="icon i-tv">📺</div><div class="label">BOM TV</div></button>
              <button class="app-tile" data-app="ft"><div class="icon i-ft">📹</div><div class="label">FaceTime</div></button>
              <button class="app-tile" data-app="settings"><div class="icon i-settings">⚙️</div><div class="label">Settings</div></button>

              <button class="app-tile" data-app="bom"><div class="icon i-bom">B</div><div class="label">봄톤</div></button>
            </div>

            <div class="dock">
              <button class="app-tile" data-app="phone"><div class="icon i-ft">📞</div></button>
              <button class="app-tile" data-app="msg"><div class="icon i-ft">💬</div></button>
            </div>
            <div class="search-pill">⌘ Search</div>
          </section>

          <!-- ===== Apps (modals) ===== -->
          <div class="app-screen" id="app-msg">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">톡 (읽기 전용)</div><span class="spacer"></span></div>
              <div class="body">
                <div class="chat">
                  <div class="bubble other">[공지] 시즌그리팅 일정 공개! 04/01 티저, 04/23~26 POP-UP</div>
                  <div class="bubble me">링크는 어디서 확인해요?</div>
                  <div class="bubble other">웹(Web) 앱에서 이동 가능합니다.</div>
                  <div class="attach">이미지/링크 첨부 미리보기 (상호작용 비활성)</div>
                </div>
              </div>
            </div>
          </div>

          <div class="app-screen" id="app-cal">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">Calendar · 2025년 4월</div><span class="spacer"></span></div>
              <div class="body">
                <div class="cal">
                  <div class="month"> <span>April 2025</span> <span>9:41 AM</span></div>
                  <div class="grid">
                    <div class="day"></div><div class="day"></div><div class="day">1</div><div class="day">2</div><div class="day">3</div><div class="day">4</div><div class="day">5</div>
                    <div class="day">6</div><div class="day">7</div><div class="day">8</div><div class="day">9</div><div class="day">10</div><div class="day">11</div><div class="day">12</div>
                    <div class="day">13</div><div class="day">14</div><div class="day">15</div><div class="day">16</div><div class="day">17</div><div class="day">18</div><div class="day">19</div>
                    <div class="day mark">20</div><div class="day">21</div><div class="day">22</div><div class="day range">23</div><div class="day range">24</div><div class="day range">25</div><div class="day range">26<div class="pop-label">POP-UP</div></div>
                    <div class="day">27</div><div class="day">28</div><div class="day">29</div><div class="day">30</div><div class="day"></div><div class="day"></div><div class="day"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <div class="app-screen" id="app-web">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">Web · 구매/예약</div><span class="spacer"></span></div>
              <div class="body">
                <div class="list">
                  <a class="card" href="#" data-link="shop" target="_blank" style="display:block; padding:12px; border-radius:14px; background:#0d1424; border:1px solid rgba(255,255,255,.06); text-decoration:none; color:#e5e7eb"><strong>굿즈 스토어 (재이미샵)</strong><div class="muted" style="color:#9ca3af; font-size:12px">새 탭으로 이동</div></a>
                  <a class="card" href="#" data-link="popup" target="_blank" style="display:block; padding:12px; border-radius:14px; background:#0d1424; border:1px solid rgba(255,255,255,.06); text-decoration:none; color:#e5e7eb"><strong>팝업 예약</strong><div class="muted" style="color:#9ca3af; font-size:12px">새 탭으로 이동</div></a>
                </div>
              </div>
            </div>
          </div>

          <div class="app-screen" id="app-gallery">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">갤러리 · 보관함</div><span class="spacer"></span></div>
              <div class="body">
                <div class="gallery-grid" id="ggrid">
                  <img src="https://images.unsplash.com/photo-1520975922284-7b5168a6df4a?q=80&w=600&auto=format&fit=crop" alt="컷1" />
                  <img src="https://images.unsplash.com/photo-1517841905240-472988babdf9?q=80&w=600&auto=format&fit=crop" alt="컷2" />
                  <img src="https://images.unsplash.com/photo-1494790108377-be9c29b29330?q=80&w=600&auto=format&fit=crop" alt="컷3" />
                  <img src="https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?q=80&w=600&auto=format&fit=crop" alt="컷4" />
                  <img src="https://images.unsplash.com/photo-1549880338-65ddcdfd017b?q=80&w=600&auto=format&fit=crop" alt="컷5" />
                  <img src="https://images.unsplash.com/photo-1520975922284-7b5168a6df4a?q=80&w=600&auto=format&fit=crop" alt="컷6" />
                </div>
              </div>
            </div>
          </div>
          <div class="lightbox" id="lightbox"><img alt="preview" id="lightimg" /></div>

          <div class="app-screen" id="app-ott">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">BOM TV</div><span class="spacer"></span></div>
              <div class="body">
                <div id="pvBefore" class="noise">準備中</div>
                <iframe id="pvAfter" class="video" style="display:none;" src="https://www.youtube-nocookie.com/embed/Q-6hVfCovKs" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
                <div class="muted" style="margin-top:10px; font-size:12px; color:#9ca3af">PV 공개 전에는 노이즈 화면, 공개 후에는 영상으로 자동 전환(변수로 제어)</div>
              </div>
            </div>
          </div>

          <div class="app-screen" id="app-note">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">메모장 (힌트)</div><span class="spacer"></span></div>
              <div class="body">
                <div class="card" style="padding:12px; border-radius:12px; background:#0d1424; border:1px solid rgba(255,255,255,.06)"><strong>암호</strong><div class="muted" style="color:#9ca3af; font-size:12px">달력의 붉은 날을 이어서 읽어보세요.</div></div>
              </div>
            </div>
          </div>

          <div class="app-screen" id="app-map">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">지도</div><span class="spacer"></span></div>
              <div class="body">
                <!-- 지도가 그려질 영역 -->
                <div id="map-canvas"></div>
              </div>
            </div>
          </div>

          <div class="app-screen" id="app-ft">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">FaceTime</div><span class="spacer"></span></div>
              <div class="body">
                <div class="video">셀카 형태의 PV 컷 삽입 영역</div>
              </div>
            </div>
          </div>

          <div class="app-screen" id="app-settings">
            <div class="app">
              <div class="bar"><button class="x" data-close>✕</button><div class="title">Settings</div><span class="spacer"></span></div>
              <div class="body">
                <div class="list" style="display:grid; gap:10px;">
                  <label class="card" style="display:flex; align-items:center; gap:10px; padding:12px; border-radius:12px; background:#0d1424; border:1px solid rgba(255,255,255,.06)">
                    <input type="checkbox" id="pvToggle" /> <span>PV 공개됨 (체크 시 영상 표시)</span>
                  </label>
                </div>
              </div>
            </div>
          </div>

        </div><!-- /screen -->
      </div>
    </div>
  </div>

  <!-- ===== Share Modal ===== -->
  <div class="share-modal-overlay" id="shareModal">
    <div class="share-box">
        <p>이 페이지 공유하기</p>
        <a href="#" id="shareTwitter" class="share-link" title="X(트위터)에 공유">
            <svg viewBox="0 0 24 24" aria-hidden="true">
                <path fill="currentColor" d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
            </svg>
        </a>
        <button class="close-share" id="closeShareBtn">✕</button>
    </div>
  </div>

  <script>
    // 전역 변수로 지도 인스턴스를 관리
    window.mapInstance = null;

    // 지도 초기화 함수
    window.initMap = function initMap() {
      const position = { lat: 37.5665, lng: 126.9780 }; // 서울 시청
      const mapCanvas = document.getElementById('map-canvas');
      
      // 지도 컨테이너가 없으면 함수 종료
      if (!mapCanvas) return;

      // 이미 지도가 생성되었다면, 크기만 재조정하고 중앙으로 이동
      if (window.mapInstance) {
        google.maps.event.trigger(window.mapInstance, 'resize');
        window.mapInstance.setCenter(position);
        return;
      }

      // 지도 생성 (안정적인 구식 마커 사용)
      const map = new google.maps.Map(mapCanvas, {
        zoom: 14,
        center: position,
      });
      new google.maps.Marker({
        map: map,
        position: position,
        title: 'Seoul City Hall'
      });

      // 생성된 지도 인스턴스를 전역 변수에 저장
      window.mapInstance = map;
    };

    // ===== Configurable links =====
    const LINKS = { shop: 'https://j-meeshop.com', popup: 'https://example.com/popup' };
    document.querySelectorAll('[data-link]').forEach(a=>{ const key=a.getAttribute('data-link'); if(LINKS[key]) a.href = LINKS[key]; });

    // Time
    const pad=n=>n.toString().padStart(2,'0');
    function fmt(now){ const y=now.getFullYear(); const m=pad(now.getMonth()+1); const d=pad(now.getDate()); const days=['일','월','화','수','목','금','토']; return {time:`${pad(now.getHours())}:${pad(now.getMinutes())}`, date:`${y}년 ${m}월 ${d}일 (${days[now.getDay()]})`}; }
    function tick(){ const now=new Date(); const f=fmt(now); sb_time.textContent=f.time; lock_clock.textContent=f.time; lock_date.textContent=f.date; }
    const sb_time = document.getElementById('sb-time');
    const lock_clock = document.getElementById('lock-clock');
    const lock_date = document.getElementById('lock-date');
    setInterval(tick,1000); tick();

    // ===== Lock → Home: 알림 외 영역 탭 or 위로 스와이프 =====
    const lockEl=document.getElementById('lock');
    const homeEl=document.getElementById('home');
    const notifStack=document.getElementById('notifStack');

    // 더미 알림 채우기 (스크롤 가능)
    const DUMMY = [
      {t:'김준완 연차', d:'8월18일 이사해야함'},
      {t:'구내 시당', d:'이번주는 거르는게 답'},
      {t:'톡', d:'[공지] 굿즈 예판 링크 안내'},
      {t:'News', d:'티저 이미지 티징 (클릭 불가)'},
      {t:'BOM TV', d:'PV 공개 D-3 · 홈에서 확인'},
      {t:'Calendar', d:'4/23–26 POP-UP'},
      {t:'Notes', d:'“home is where the heart is”'},
    ];
    DUMMY.forEach(n=>{
      const el=document.createElement('div');
      el.className='notif';
      el.innerHTML=`<div class="t">${n.t}</div><div class="d">${n.d}</div>`;
      el.addEventListener('click', e=> e.stopPropagation()); // 잠금 해제 방지
      notifStack.appendChild(el);
    });

    // 알림 영역 이외 클릭 시 해제
    lockEl.addEventListener('click', (e)=>{
      if (e.target.closest('#notifStack')) return; // 알림 내부면 무시
      unlock();
    });

    // 위로 스와이프 해제
    let startY=null;
    lockEl.addEventListener('touchstart', e=> startY = e.touches[0].clientY, {passive:true});
    lockEl.addEventListener('touchmove', e=>{
      if(startY===null) return;
      const dy = startY - e.touches[0].clientY;
      if(dy > 40){ unlock(); startY=null; }
    }, {passive:true});
    lockEl.addEventListener('touchend', ()=> startY=null);

    function unlock(){
      // 애니메이션: 잠금화면 위로 사라지고 홈은 페이드-인
      lockEl.classList.add('unlocking');
      setTimeout(()=>{
        lockEl.style.display='none';
        homeEl.hidden=false;
        requestAnimationFrame(()=> homeEl.classList.add('show'));
      }, 320);
    }

    // ===== Apps open/close (안정화된 버전) =====
    document.querySelectorAll('.app-tile').forEach(button => {
        button.addEventListener('click', () => {
            const appId = button.getAttribute('data-app');
            if (!appId) return;

            const appScreen = document.getElementById(`app-${appId}`);
            if (!appScreen) return;

            appScreen.style.display = 'flex';

            // 지도 앱이 열릴 때만 initMap 함수를 호출
            if (appId === 'map') {
              // 모달이 실제로 화면에 그려진 후 지도를 생성하도록 약간의 지연을 줌
              requestAnimationFrame(() => {
                  setTimeout(() => window.initMap(), 0);
              });
            }
        });
    });

    document.querySelectorAll('.app-screen').forEach(appScreen => {
        appScreen.addEventListener('click', (event) => {
            if (event.target === appScreen) {
                appScreen.style.display = 'none';
            }
        });
        const closeButton = appScreen.querySelector('[data-close]');
        if (closeButton) {
            closeButton.addEventListener('click', () => {
                appScreen.style.display = 'none';
            });
        }
    });

    // Gallery lightbox
    const lightbox=document.getElementById('lightbox'); const lightimg=document.getElementById('lightimg');
    document.getElementById('ggrid').addEventListener('click', e=>{ if(e.target.tagName==='IMG'){ lightimg.src=e.target.src; lightbox.style.display='flex'; } });
    lightbox.addEventListener('click', ()=> lightbox.style.display='none');

    // BOM TV PV 토글
    const pvToggle=document.getElementById('pvToggle');
    const pvBefore=document.getElementById('pvBefore'); const pvAfter=document.getElementById('pvAfter');
    function applyPV(v){ 
      pvBefore.style.display = v ? 'none' : 'grid'; 
      pvAfter.style.display = v ? 'block' : 'none';
    }
    if(pvToggle){ pvToggle.addEventListener('change', e=> applyPV(e.target.checked)); }
    applyPV(false);

    // ===== Share Modal Logic =====
    const shareBtn = document.getElementById('shareBtn');
    const shareModal = document.getElementById('shareModal');
    const closeShareBtn = document.getElementById('closeShareBtn');
    const shareTwitter = document.getElementById('shareTwitter');

    if(shareBtn) {
      shareBtn.addEventListener('click', () => {
        shareModal.style.display = 'flex';
      });
    }

    function closeShareModal() {
      shareModal.style.display = 'none';
    }

    closeShareBtn.addEventListener('click', closeShareModal);

    shareModal.addEventListener('click', (e) => {
      if (e.target === shareModal) {
        closeShareModal();
      }
    });

    shareTwitter.addEventListener('click', (e) => {
      e.preventDefault();
      const shareText = "김빠지게 못하겠단 소리 하지마라 \n도전 하는게 중요 한거다\n호기롭게 시작한 만큼 끝까지 해보자";
      const shareUrl = window.location.href;
      const twitterUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(shareUrl)}`;
      window.open(twitterUrl, '_blank', 'width=600,height=400');
    });

    // ESC 키로 앱 또는 공유창 닫기 (정리된 버전)
    document.addEventListener('keydown', e => {
      if (e.key === 'Escape') {
        if (shareModal && getComputedStyle(shareModal).display !== 'none') {
            closeShareModal();
            return;
        }
        const opens = [...document.querySelectorAll('.app-screen')].filter(s => getComputedStyle(s).display !== 'none');
        const top = opens.at(-1);
        if (top) top.style.display = 'none';
      }
    });
  </script>
</body>
</html>
